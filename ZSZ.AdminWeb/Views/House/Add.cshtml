@model ZSZ.AdminWeb.Models.HouseAddDataModel
@{
    ViewBag.Title = "新增房源";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- 编辑器源码文件 -->
<script type="text/javascript" src="~/lib/utf8-net/ueditor.config.js"></script>
<script type="text/javascript" src="~/lib/utf8-net/ueditor.all.js"></script>
<div class="pd-20">
    <form id="formAdd">
        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>区域：</label>
                <div class="formControls col-2">
                    <select name="regionId" class="select" id="region">
                        @foreach (var region in Model.Regions)
                        {
                            <option value="@region.Id">@region.Name</option>
                        }
                    </select>
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>小区：</label>
                <div class="formControls col-2">
                    <select name="communityId" id="community" class="select">
                    </select>
                </div>
            </div>
            <label class="form-label col-2 text-c"><span class="c-red">*</span>房型：</label>
            <div class="formControls col-2">
                <select name="roomTypeId" class="select">
                    @foreach (var roomType in Model.RoomTypes)
                    {
                        <option value="@roomType.Id">@roomType.Name</option>
                    }
                </select>
            </div>
        </div>
        
        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>地址：</label>
                <div class="formControls col-6">
                    <input type="text" class="input-text" name="address" />
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>月租金：</label>
                <div class="formControls col-1">
                    <input type="text" class="input-text" name="monthRent" />               
                </div>
                <label class="form-label col-1 text-c"><span class="c-red"></span>元</label>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>状态：</label>
                <div class="formControls col-2">
                    <select name="statusId" class="select">
                        @foreach (var status in Model.Status)
                        {
                            <option value="@status.Id">@status.Name</option>
                        }
                    </select>
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>面积：</label>
                <div class="formControls col-1">
                    <input type="text" class="input-text" name="area" />
                </div>
                <label class="form-label col-1 text-c"><span class="c-red"></span>平米</label>
            </div>
            <label class="form-label col-2 text-c"><span class="c-red">*</span>装修：</label>
            <div class="formControls col-2">
                <select name="decorateStatusId" class="select">
                    @foreach (var decorateStatus in Model.DecorateStatus)
                    {
                        <option value="@decorateStatus.Id">@decorateStatus.Name</option>
                    }
                </select>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>楼层：</label>
                <div class="formControls col-1">
                    <input type="text" class="input-text" placeholder="层数" name="floorIndex" />
                </div>                
                <div class="formControls col-1">
                    <input type="text" class="input-text" placeholder="总层" name="totalFloorCount" />
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>朝向：</label>
                <div class="formControls col-2">
                    <input type="text" class="input-text" name="direction" />
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>房屋类别：</label>
                <div class="formControls col-2">
                    <select name="typeId" class="select">
                        @foreach (var type in Model.Types)
                        {
                            <option value="@type.Id">@type.Name</option>
                        }
                    </select>
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>可看房时间：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text Wdate" name="lookableDateTime" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" />
                </div>
            </div>
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>入住时间：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text Wdate" name="checkInDateTime" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>业主姓名：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text" name="ownerName" />
                </div>
            </div>
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>业主手机号：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text" name="ownerPhoneNum" />
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>房源描述：</label>
                <div class="formControls col-10">
                    <!--<textarea name="description" rows="6" cols="101"></textarea>-->
                    <script id="container" name="description" type="text/plain">
                    </script>
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>配套设施：</label>
                <div class="formControls col-10">
                    @foreach (var attachment in Model.Attachments)
                    {
                        <label class="form-label col-2" for="attachment_@attachment.Id">@attachment.Name<input type="checkbox" id="attachment_@attachment.Id" name="attachmentIds" value="@attachment.Id" /></label>                        
                    }                    
                </div>
            </div>
        </div>

        <div class="row cl">
            <div class="col-9 col-offset-3">
                <input class="btn btn-primary radius" type="button" id="btnSave" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>
</div>
@section FooterScript
{
<script type="text/javascript">
    var ue = UE.getEditor('container');

    $(function () {       
        var validForm = $("#formAdd").Validform({ tiptype: 2 });
        $("#btnSave").click(function () {
            if(validForm.check(false))
            {
                var data = $("#formAdd").serializeArray();
                $.ajax({
                    type: "post", url: "/House/Add", data: data,
                    success: function (result) {
                        parent.location.reload();
                    },
                    error: function () {
                        alert("出错了");
                    }
                });
            }
        });

        $("#region").change(function () {
            var community;
            $.ajax({
                type: "post", dataType: "json", url: "/House/GetCommunity", data: { id: this.value },
                success: function (result) {
                    if(result.status=="ok")
                    {
                        $("#community").empty();                        
                        for(var i=0;i<result.data.length;i++)
                        {
                            var item = result.data[i];
                            $("#community").append("<option value='"+item.id+"'>" + item.name + "</option>");
                        }
                    }
                },
            });
        });
        $("#region").change();
    });    
</script>
}