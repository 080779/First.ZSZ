@model ZSZ.AdminWeb.Models.HouseEditDataModel
@{
    ViewBag.Title = "编辑房源";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="pd-20">
    <form id="formAdd">
        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>区域：</label>
                <div class="formControls col-2">
                    <input type="hidden" name="id" value="@Model.house.Id"/>
                    <select name="regionId" class="select" id="region">
                        @foreach (var region in Model.Regions)
                        {
                            <option value="@region.Id" selected="@Model.house.RegionId.Equals(region.Id)">@region.Name</option>
                        }
                    </select>
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>小区：</label>
                <div class="formControls col-2">
                    <select name="communityId" id="community" class="select">
                    </select>
                </div>
            </div>
            <label class="form-label col-2 text-c"><span class="c-red">*</span>房型：</label>
            <div class="formControls col-2">
                <select name="roomTypeId" class="select">
                    @foreach (var roomType in Model.RoomTypes)
                    {
                        <option value="@roomType.Id" selected="@Model.house.RoomTypeId.Equals(roomType.Id)">@roomType.Name</option>
                    }
                </select>
            </div>
        </div>
        
        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>地址：</label>
                <div class="formControls col-6">
                    <input type="text" class="input-text" name="address" value="@Model.house.Address"/>
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>月租金：</label>
                <div class="formControls col-1">
                    <input type="text" class="input-text" name="monthRent" value="@Model.house.MonthRent"/>               
                </div>
                <label class="form-label col-1 text-c"><span class="c-red"></span>元</label>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>状态：</label>
                <div class="formControls col-2">
                    <select name="statusId" class="select">
                        @foreach (var status in Model.Status)
                        {
                            <option value="@status.Id" selected="@Model.house.StatusId.Equals(@status.Id)">@status.Name</option>
                        }
                    </select>
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>面积：</label>
                <div class="formControls col-1">
                    <input type="text" class="input-text" name="area" value="@Model.house.Area"/>
                </div>
                <label class="form-label col-1 text-c"><span class="c-red"></span>平米</label>
            </div>
            <label class="form-label col-2 text-c"><span class="c-red">*</span>装修：</label>
            <div class="formControls col-2">
                <select name="decorateStatusId" class="select">
                    @foreach (var decorateStatus in Model.DecorateStatus)
                    {
                        <option value="@decorateStatus.Id" selected="@Model.house.DecorateStatusId.Equals(decorateStatus.Id)">@decorateStatus.Name</option>
                    }
                </select>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>楼层：</label>
                <div class="formControls col-1">
                    <input type="text" class="input-text" placeholder="层数" name="floorIndex" value="@Model.house.FloorIndex"/>
                </div>                
                <div class="formControls col-1">
                    <input type="text" class="input-text" placeholder="总层" name="totalFloorCount" value="@Model.house.TotalFloorCount"/>
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>朝向：</label>
                <div class="formControls col-2">
                    <input type="text" class="input-text" name="direction" value="@Model.house.Direction"/>
                </div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>房屋类别：</label>
                <div class="formControls col-2">
                    <select name="typeId" class="select">
                        @foreach (var type in Model.Types)
                        {
                            <option value="@type.Id" selected="@Model.house.TypeId.Equals(type.Id)">@type.Name</option>
                        }
                    </select>
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>可看房时间：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text Wdate" name="lookableDateTime" value="@Model.house.LookableDateTime" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
                </div>
            </div>
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>入住时间：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text Wdate" name="checkInDateTime" value="@Model.house.CheckInDateTime" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})"/>
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>业主姓名：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text" name="ownerName" value="@Model.house.OwnerName"/>
                </div>
            </div>
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>业主手机号：</label>
                <div class="formControls col-4">
                    <input type="text" class="input-text" name="ownerPhoneNum" value="@Model.house.OwnerPhoneNum"/>
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>房源描述：</label>
                <div class="formControls col-10">
                    <textarea name="description" rows="6" cols="101">@Model.house.Description</textarea>
                </div>
            </div>
        </div>

        <div class="row cl">
            <div>
                <label class="form-label col-2 text-c"><span class="c-red">*</span>配套设施：</label>
                <div class="formControls col-10">
                    @foreach (var attachment in Model.Attachments)
                    {
                        <label class="form-label col-2" for="attachment_@attachment.Id">@attachment.Name<input type="checkbox" id="attachment_@attachment.Id" name="attachmentIds" value="@attachment.Id" checked="@Model.house.AttachmentIds.Contains(attachment.Id)"/></label>                        
                    }                    
                </div>
            </div>
        </div>

        <div class="row cl">
            <div class="col-9 col-offset-3">
                <input class="btn btn-primary radius" type="button" id="btnSave" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>
</div>
@section FooterScript
{
<script type="text/javascript">
    $(function () {       
        var validForm = $("#formAdd").Validform({ tiptype: 2 });
        $("#btnSave").click(function () {
            if(validForm.check(false))
            {
                var data = $("#formAdd").serializeArray();
                $.ajax({
                    type: "post", url: "/House/Edit", data: data,
                    success: function (result) {
                        parent.location.reload();
                    },
                    error: function () {
                        alert("出错了");
                    }
                });
            }
        });

        $("#region").change(function () {
            var community;
            $.ajax({
                type: "post",dataType:"json", url: "/House/GetCommunity", data:{ id:this.value},
                success: function (result) {
                    if(result.status=="ok")
                    {
                        $("#community").empty();                        
                        for(var i=0;i<result.data.length;i++)
                        {
                            var item = result.data[i];
                            if(item.id==(@Model.house.CommunityId))
                            {
                                $("#community").append("<option value='"+item.id+"' selected='selected'>" + item.name + "</option>");
                            }
                            else
                            {
                                $("#community").append("<option value='"+item.id+"'>" + item.name + "</option>");
                            }                            
                        }
                    }
                },
            });
        });
        $("#region").change();
    });    
</script>
}